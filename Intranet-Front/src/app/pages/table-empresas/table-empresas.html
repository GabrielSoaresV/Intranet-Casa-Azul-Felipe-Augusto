<div class="layout d-flex flex-column vh-90">

  <!-- Container da tabela -->
  <div class="table-container flex-grow-1 overflow-auto p-3">
    <table class="table table-hover">
      <caption class="text-center fw-bold">Lista de Empresas</caption>
      <thead class="table-dark">
        <tr>
          <th class="text-center">Nome</th>
          <th class="text-center">CNPJ</th>
          <th class="text-center">Email</th>
          <th class="text-center">Telefone</th>
          <th class="text-center"></th>
        </tr>
      </thead>
      <tbody>   
        <ng-container *ngFor="let empresa of empresas; let i = index">
          <!-- Linha principal -->
          <tr (click)="toggleDetalhes(i)" class="align-middle">
            <td class="text-center">{{ empresa.nomeEmpresa }}</td>
            <td class="text-center">{{ formatarCnpj(empresa.cnpj) }}</td>
            <td class="text-center">{{ empresa.emailEmpresa }}</td>
            <td class="text-center">{{ empresa.telefoneEmpresa }}</td>
            <td class="d-flex justify-content-center gap-3">
              <button class="btn btn-primary btn-sm" (click)="$event.stopPropagation(); confirmar(empresa)">Enviar</button>
              <button class="btn btn-warning btn-sm" (click)="$event.stopPropagation(); editarRegistro(empresa)">Editar</button>
              <button class="btn btn-danger btn-sm" (click)="$event.stopPropagation(); excluir(empresa.cnpj)">Excluir</button>
            </td>
          </tr>

          <!-- Linha expandida -->
          <tr *ngIf="registroExpandido === i">
            <td colspan="5" class="p-0">
              <div class="bg-light border rounded d-flex justify-content-center flex-wrap gap-4 p-4">

                <div class="flex-fill min-w-200 text-center" style="padding-left: 2rem;">
                  <strong>Nome do Supervisor de RH:</strong><br>
                  {{ empresa.rhNomeResponsavel || 'Não informado' }}
                </div>

                <div class="flex-fill min-w-200 text-center" style="padding-left: 2rem;">
                  <strong>Email do Supervisor de RH:</strong><br>
                  {{ empresa.rhEmailResponsavel || 'Não informado' }}
                </div>

              </div>
            </td>
          </tr>
        </ng-container>

        <tr *ngIf="empresas.length === 0">
          <td colspan="5" class="text-center">Nenhuma empresa cadastrada.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Angular puro -->
<div *ngIf="registroEditando" class="modal-backdrop" (click)="fecharModal()">
  <div class="modal-dialog-custom" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title"><strong>Editar Registro - Empresa</strong></h5>
    </div>

    <div class="modal-body">
      <form>
        <div class="mb-3">
          <label for="cnpj" class="form-label">CNPJ</label>
          <input id="cnpj" type="text" class="form-control" [(ngModel)]="registroEditando.cnpj" name="cnpj">
        </div>
        <div class="mb-3">
          <label for="nomeEmpresa" class="form-label">Nome da Empresa</label>
          <input id="nomeEmpresa" type="text" class="form-control" [(ngModel)]="registroEditando.nomeEmpresa" name="nomeEmpresa">
        </div>
        <div class="mb-3">
          <label for="emailEmpresa" class="form-label">Email da Empresa</label>
          <input id="emailEmpresa" type="email" class="form-control" [(ngModel)]="registroEditando.emailEmpresa" name="emailEmpresa">
        </div>
        <div class="mb-3">
          <label for="telefoneEmpresa" class="form-label">Telefone da Empresa</label>
          <input id="telefoneEmpresa" type="text" class="form-control" [(ngModel)]="registroEditando.telefoneEmpresa" name="telefoneEmpresa">
        </div>
        <div class="mb-3">
          <label for="rhNomeResponsavel" class="form-label">Nome do Supervisor de RH</label>
          <input id="rhNomeResponsavel" type="text" class="form-control" [(ngModel)]="registroEditando.rhNomeResponsavel" name="rhNomeResponsavel">
        </div>
        <div class="mb-3">
          <label for="rhEmailResponsavel" class="form-label">Email do Supervisor de RH</label>
          <input id="rhEmailResponsavel" type="email" class="form-control" [(ngModel)]="registroEditando.rhEmailResponsavel" name="rhEmailResponsavel">
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="salvarEdicao()">Salvar</button>
      <button type="button" class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
    </div>
  </div>
</div>
