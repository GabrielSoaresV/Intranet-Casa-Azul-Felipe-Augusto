<app-navbar></app-navbar>

<div class="demands-container mat-elevation-z4 bg-white rounded-xl shadow-sm p-6">

  <!-- üîé Barra de filtro -->
  <div class="filter-bar">
    <input
      type="text"
      placeholder="Buscar por nome ou matr√≠cula..."
      [(ngModel)]="filters.term"
      (keyup.enter)="searchJovens()"
    />
  
    <select [(ngModel)]="filters.status" (change)="searchJovens()">
      <option value="">Todos os status</option>
      <option value="ATIVO">Ativo</option>
      <option value="INATIVO">Inativo</option>
    </select>
  
    <select [(ngModel)]="filters.empresa" (change)="searchJovens()">
      <option value="">Todas as empresas</option>
      <option *ngFor="let emp of empresas" [value]="emp">
        {{ emp }}
      </option>
    </select>
  
    <button class="btn-search" (click)="searchJovens()">Buscar</button>
    <button class="btn-clear" (click)="clearFilters()">Limpar</button>
  </div>

  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <div class="overflow-x-auto rounded-lg border border-gray-100 mt-4">

    <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="w-full">

      <!-- STATUS -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="center-header text-center">Status</th>
        <td mat-cell *matCellDef="let jovem" class="text-center">

          <div class="status-wrapper">
            <span class="status-dot" [ngClass]="getStatusClass(jovem)"></span>
          </div>

          <small class="status-text">
            {{ getStatusInfo(jovem) }}
          </small>

        </td>
      </ng-container>

      <!-- Nome -->
      <ng-container matColumnDef="nome">
        <th mat-header-cell *matHeaderCellDef class="text-center">Nome</th>
        <td mat-cell *matCellDef="let jovem" class="text-center">
          {{ jovem.nome }}
        </td>
      </ng-container>

      <!-- Matricula -->
      <ng-container matColumnDef="matricula">
        <th mat-header-cell *matHeaderCellDef class="text-center">Matr√≠cula</th>
        <td mat-cell *matCellDef="let jovem" class="text-center">
          {{ jovem.matricula }}
        </td>
      </ng-container>

      <!-- Contrata√ß√£o -->
      <ng-container matColumnDef="contratacao">
        <th mat-header-cell *matHeaderCellDef class="text-center">Contrata√ß√£o</th>
        <td mat-cell *matCellDef="let jovem" class="text-center">
          {{ jovem.contratacao | date:'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <!-- Empresa -->
      <ng-container matColumnDef="empresa">
        <th mat-header-cell *matHeaderCellDef class="text-center">Empresa</th>
        <td mat-cell *matCellDef="let jovem" class="text-center">
          {{ jovem.empresa?.nomeEmpresa || 'N√£o informado' }}
        </td>
      </ng-container>

      <!-- Per√≠odo -->
      <ng-container matColumnDef="periodoAvaliacao">
        <th mat-header-cell *matHeaderCellDef>Per√≠odo</th>
        <td mat-cell *matCellDef="let jovem">
          {{ jovem.periodoAvaliacao }} meses
        </td>
      </ng-container>

      <!-- A√ß√µes -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="center-header text-center">A√ß√µes</th>
        <td mat-cell *matCellDef="let jovem" class="actions-cell text-center">

          <button mat-icon-button matTooltip="Criar Avalia√ß√£o"
                  (click)="irParaAvaliacao(jovem); $event.stopPropagation()">
            <mat-icon class="action-icon">send</mat-icon>
          </button>

          <button mat-icon-button matTooltip="Enviar Email"
                  (click)="enviarEmail(jovem); $event.stopPropagation()">
            <mat-icon class="action-icon">mail</mat-icon>
          </button>

          <button mat-icon-button matTooltip="Editar Registro"
                  (click)="editarRegistro(jovem); $event.stopPropagation()">
            <mat-icon class="action-icon">edit</mat-icon>
          </button>

          <button mat-icon-button color="warn" matTooltip="Excluir Jovem"
                  (click)="excluir(jovem.matricula); $event.stopPropagation()">
            <mat-icon class="action-icon">delete</mat-icon>
          </button>

        </td>
      </ng-container>

      <!-- EXPANDED SECTION -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let jovem" [attr.colspan]="displayedColumns.length">

          <div class="expanded-container animate-expand">

            <h3 class="expanded-title">Detalhes do Jovem</h3>

            <div class="expanded-grid">

              <div class="expanded-item">
                <strong>Rescis√£o:</strong>
                {{ jovem.rescisao || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Telefone:</strong>
                {{ jovem.telefone || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Email:</strong>
                {{ jovem.email || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Per√≠odo:</strong>
                {{ jovem.periodoAvaliacao }} meses
              </div>

              <div class="expanded-item">
                <strong>Telefone da Empresa:</strong>
                {{ jovem.empresa?.telefoneEmpresa || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Telefone RH (Empresa):</strong>
                {{ jovem.empresa?.rhTelefone || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Email RH (Empresa):</strong>
                {{ jovem.empresa?.rhEmailResponsavel || 'N√£o informado' }}
              </div>

              <div class="expanded-item">
                <strong>Pr√≥xima Avalia√ß√£o:</strong>

                <span *ngIf="getDiasParaProximaAvaliacao(jovem) as dias">
                  <ng-container *ngIf="dias === null">N√£o definido</ng-container>
                  <ng-container *ngIf="dias === 0">Vence hoje</ng-container>
                  <ng-container *ngIf="dias > 0">{{ dias }} dias restantes</ng-container>
                  <ng-container *ngIf="dias < 0">Atrasado h√° {{ -dias }} dias</ng-container>
                </span>
              </div>

              <div class="expanded-item wide">
                <strong>Observa√ß√µes:</strong>
                <p class="expanded-description">
                  {{ jovem.observacoes || 'Nenhuma observa√ß√£o.' }}
                </p>
              </div>

            </div>
          </div>

        </td>
      </ng-container>

      <!-- HEADER -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!-- ROW -->
      <tr
        mat-row
        *matRowDef="let jovem; columns: displayedColumns"
        class="hover:bg-gray-50 transition-all cursor-pointer"
        (click)="toggleExpand(jovem)"
      ></tr>

      <!-- ROW EXPANDED -->
      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        [class.hidden]="expandedElement !== row"
      ></tr>

    </table>

  </div>

  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

</div>
