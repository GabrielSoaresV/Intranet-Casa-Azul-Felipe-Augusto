<app-navbar></app-navbar>

<div class="demands-list-container">
  <h1>Minhas Demandas</h1>

  <div *ngIf="loading" class="loading">Carregando suas demandas...</div>
  <div *ngIf="errorMessage && !loading" class="error">{{ errorMessage }}</div>

  <div *ngIf="!loading && demands.length === 0" class="empty">
    <p>Voc√™ ainda n√£o possui demandas registradas.</p>
    <a routerLink="/demand-register" class="btn-new">+ Nova Demanda</a>
  </div>

  <div *ngIf="!loading && demands.length > 0" class="demand-cards">
    <div
      class="demand-card"
      *ngFor="let demand of demands"
      (click)="toggleExpand(demand)"
      [class.expanded]="expandedDemand === demand"
    >
      <div class="demand-header">
        <div class="demand-info">
          <h3>{{ demand.title }}</h3>
          <small class="demand-id">ID: {{ demand.id }}</small>
        </div>

        <span [ngClass]="getStatusClasses(demand.status)" class="status-chip">
          {{ formatStatus(demand.status) }}
        </span>
      </div>

      <div class="demand-actions">
        <button
          class="chat-btn"
          title="Abrir chat"
          (click)="openChat(demand.id!, $event)"
        >
          <mat-icon>chat</mat-icon>
          <span>Chat</span>
        </button>
      </div>

      <!-- üîΩ Expans√£o -->
      <div class="demand-details" *ngIf="expandedDemand === demand">
        <div class="details-inner animate-expand">
          <p><strong>T√≠tulo:</strong> {{ demand.title }}</p>
          <p><strong>Descri√ß√£o:</strong> {{ demand.description }}</p>
          <p><strong>Respons√°vel:</strong> {{ demand.assignedUser?.name || '‚Äî' }}</p>
          <p><strong>Status:</strong> {{ formatStatus(demand.status) }}</p>
          <p><strong>Criada em:</strong> {{ formatDate(demand.createdAt) }}</p>
          <p><strong>√öltima atualiza√ß√£o:</strong> {{ formatDate(demand.updatedAt) }}</p>
          <p *ngIf="demand.category"><strong>Categoria:</strong> {{ demand.category }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
