<div class="table-container">

  <!-- Cabe√ßalho fixo (n√£o rola) -->
  <table class="table tabela-registros">
    <caption class="table-caption">Lista de Jovens</caption>

    <thead>
      <tr>
        <th class="text-center">Nome</th>
        <th class="text-center">Matr√≠cula</th>
        <th class="text-center">Contrata√ß√£o</th>
        <th class="text-center">Empresa</th>
        <th class="text-center">Per√≠odo</th>
        <th class="text-center">A√ß√µes</th>
      </tr>
    </thead>
  </table>

  <!-- üî• Scroll SOMENTE AQUI -->
  <div class="tbody-scroll">
    <table class="table tabela-registros">

      <tbody>
        <ng-container *ngFor="let jovem of jovens; let i = index; trackBy: trackByMatricula">
          
          <!-- LINHA PRINCIPAL -->
          <tr class="hover-row" (click)="toggleDetalhes(i)">
            <td class="status-cell">
              <div class="status-wrapper">
                <div class="status-bar status-anim" [ngClass]="getStatusClass(jovem)"></div>
              </div>
            </td>

            <td class="text-center">{{ jovem.nome }}</td>
            <td class="text-center">{{ jovem.matricula }}</td>
            <td class="text-center">{{ jovem.contratacao | date:'dd/MM/yyyy' }}</td>
            <td class="text-center">{{ jovem.empresa?.nomeEmpresa || 'N√£o informado' }}</td>
            <td class="text-center">{{ jovem.periodoAvaliacao }} meses</td>

            <td class="actions-cell">
              <button mat-icon-button matTooltip="Criar uma Avalia√ß√£o"
                      (click)="$event.stopPropagation(); irParaAvaliacao(jovem)">
                <mat-icon>send</mat-icon>
              </button>

              <button mat-icon-button matTooltip="Enviar Email"
                      (click)="$event.stopPropagation(); enviarEmail(jovem)">
                <mat-icon>mail</mat-icon>
              </button>

              <button mat-icon-button matTooltip="Editar Registro"
                      (click)="$event.stopPropagation(); editarRegistro(jovem)">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button color="warn" matTooltip="Excluir Jovem"
                      (click)="$event.stopPropagation(); excluir(jovem.matricula)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>

          <!-- DETALHES EXPANDIDOS -->
          <tr *ngIf="registroExpandido === i">
            <td colspan="8" class="p-0">
              
              <div class="details-box animate-expand">
                <div class="details-grid">

                  <!-- ROW 1 (3 itens) -->
                  <div class="details-row row-3">
                    <div class="details-item">
                      <strong>Rescis√£o:</strong>
                      <span>{{ jovem.rescisao || 'N√£o informado' }}</span>
                    </div>

                    <div class="details-item">
                      <strong>Telefone do Jovem:</strong>
                      <span>{{ jovem.telefone || 'N√£o informado' }}</span>
                    </div>

                    <div class="details-item">
                      <strong>Email do Jovem:</strong>
                      <span>{{ jovem.email || 'N√£o informado' }}</span>
                    </div>
                  </div>

                  <!-- ROW 2 (2 itens) -->
                  <div class="details-row row-2">
                    <div class="details-item">
                      <strong>Respons√°vel:</strong>
                      <span>{{ jovem.nomeresponsavel || 'N√£o informado' }}</span>
                    </div>

                    <div class="details-item">
                      <strong>Telefone Respons√°vel:</strong>
                      <span>{{ jovem.telefoneresponsavel || 'N√£o informado' }}</span>
                    </div>
                  </div>

                  <!-- ROW OBSERVA√á√ïES -->
                  <div class="details-row row-full">
                    <div class="details-item">
                      <strong>Observa√ß√µes:</strong>
                      <p class="details-observacoes">
                        {{ jovem.observacoes || 'N√£o informado' }}
                      </p>
                    </div>
                  </div>

                  <!-- ROW NOVA: Pr√≥xima Avalia√ß√£o -->
                  <div class="details-row row-2">
                    <div class="details-item">
                      <strong>Pr√≥xima Avalia√ß√£o:</strong>

                      <span *ngIf="getDiasParaProximaAvaliacao(jovem) as dias">

                      <!-- N√£o definido -->
                      <ng-container *ngIf="dias === null">
                        N√£o definido
                      </ng-container>

                      <!-- Vence hoje -->
                      <ng-container *ngIf="dias === 0">
                        Vence hoje
                      </ng-container>

                      <!-- Em dias -->
                      <ng-container *ngIf="dias > 0">
                        {{ dias }} dias restantes
                      </ng-container>

                      <!-- Atrasado -->
                      <ng-container *ngIf="dias < 0">
                        Atrasado h√° {{ -dias }} dias
                      </ng-container>

                    </span>


                    </div>
                  </div>

                </div>
              </div>

            </td>
          </tr>

        </ng-container>
        <tr *ngIf="jovens.length === 0">
          <td colspan="5" class="text-center py-3">Nenhum Jovem Aprendiz cadastrado.</td>
        </tr>
      </tbody>

    </table>
  </div>
</div>


<!-- ============================
      üî• MODAL DE EDI√á√ÉO ‚Äî FORA DA TABELA
============================= -->
<div *ngIf="registroEditando" class="modal-backdrop" (click)="fecharModal()">
  <div class="modal-dialog-custom" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <h5 class="modal-title"><strong>Editar Registro - Jovem</strong></h5>
    </div>

    <div class="modal-body">
      <form>

        <div class="mb-3">
          <label class="form-label">Nome</label>
          <input type="text" class="form-control"
                 [(ngModel)]="registroEditando.nome"
                 name="nome" />
        </div>

        <div class="mb-3">
          <label class="form-label">Matr√≠cula</label>
          <input type="text" class="form-control"
                 [(ngModel)]="registroEditando.matricula"
                 name="matricula" />
        </div>

        <div class="mb-3">
          <label class="form-label">Contrata√ß√£o</label>
          <input type="date" class="form-control"
                 [(ngModel)]="registroEditando.contratacao"
                 name="contratacao" />
        </div>

        <div class="mb-3">
          <label class="form-label">Rescis√£o</label>
          <input type="date" class="form-control"
                 [(ngModel)]="registroEditando.rescisao"
                 name="rescisao" />
        </div>

        <div class="mb-3">
          <label class="form-label">Per√≠odo Avalia√ß√£o (meses)</label>
          <input type="number" class="form-control"
                 [(ngModel)]="registroEditando.periodoAvaliacao"
                 name="periodoAvaliacao" />
        </div>

        <div class="mb-3">
          <label class="form-label">Respons√°vel</label>
          <input type="text" class="form-control"
                 [(ngModel)]="registroEditando.nomeresponsavel"
                 name="resp" />
        </div>

        <div class="mb-3">
          <label class="form-label">Telefone Respons√°vel</label>
          <input type="text" class="form-control"
                 [(ngModel)]="registroEditando.telefoneresponsavel"
                 name="telresp" />
        </div>

        <div class="mb-3">
          <label class="form-label">Observa√ß√µes</label>
          <textarea class="form-control"
                    [(ngModel)]="registroEditando.observacoes"
                    name="obs"></textarea>
        </div>

      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary" (click)="salvarEdicao()">Salvar</button>
      <button class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
    </div>

  </div>
</div>


<!-- ============================
      üî• MODAL UNIVERSAL
============================= -->
<app-confirmar-model
  [aberto]="modalAberto"
  [tipo]="modalTipo"
  [titulo]="modalTitulo"
  [mensagem]="modalMensagem"
  (fechar)="fecharModalGenerico()"
  (confirmar)="executarConfirmacao()">
</app-confirmar-model>
