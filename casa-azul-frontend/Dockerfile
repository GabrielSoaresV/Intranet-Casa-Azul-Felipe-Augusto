FROM node:20 AS build
WORKDIR /app

# Copia package.json e instala dependÃªncias
COPY package*.json ./
RUN npm install

# Copia todo o projeto
COPY . .

# ðŸ”¥ Angular 20 nÃ£o usa "build:ssr"
RUN npm run build

FROM node:20
WORKDIR /app

# Copia dist do Angular buildado
COPY --from=build /app/dist/ dist/

# Instala dependÃªncias para rodar o SSR (Express etc)
COPY package*.json ./
RUN npm install --omit=dev

EXPOSE 4000

# Comando SSR correto
CMD ["node", "dist/server/server.mjs"]
